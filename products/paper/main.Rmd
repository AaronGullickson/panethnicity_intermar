---
title: "Changes in Pan-Ethnicity and Racial Boundaries in the United States based on Interracial Marriage Patterns, 1980-2018"
author:
- affiliation: University of Oregon, Sociology
  name: Aaron Gullickson
keywords: keywords
#FYI: the thanks and abstract are easier to view and edit in Atom which does proper linewrapping
thanks: Thanks to people and stuff
abstract: This is a test abstract
output:
  pdf_document: 
    citation_package: natbib
    fig_caption: yes
    template: ./resources/aog-latex-ms.tex
    keep_tex: no
  word_document:
    reference_docx: ./resources/aog_word_style.docx
fontfamily: mathpazo
fontsize: 11pt
anonymous: false #anonymize, double-space, and ragged right
endnotes: false #make footnotes endnotes
endfloat: false #move table and figures to the end
bibliography: ../project.bib
biblio-style: ./resources/ajs.bst
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, error = FALSE, 
                      warning = FALSE, eval = TRUE,
                      fig.height=3.5)
library(here)
source(here("analysis","check_packages.R"))
source(here("analysis","useful_functions.R"))
load(here("analysis","output","models.RData"))
load(here("analysis","output","alternates.RData"))
load(here("analysis","output","models_bendog.RData"))
#you need to load kableExtra in the doc
options(kableExtra.latex.load_packages = FALSE)
options(knitr.table.format = "latex")
library(kableExtra)
library(ggtext)
library(stringr)

my_palette <- c("#7b3294","#008837","#a6dba0")

#instead of loading markets, which takes forever, hardcoding sample
#sizes but be sure to adjust if this changes
#load(here("analysis","output","markets_census.RData"))
#load(here("analysis","output","markets_acs_full.RData"))
#census_n <- sum(markets_census[[1]]$choice)
#acs_n <- sum(markets_acs_full[[1]]$choice)
census_n <- 285523
acs_n <- 503348

```

```{r theme, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE, include=FALSE}
theme_mine <- function() {
  theme_bw()+
    theme(axis.title = element_text(size=10), 
          axis.text = element_text(size=8),
          legend.text=element_text(size=7),
          legend.title=element_text(size=8),
          legend.key.size = unit(0.8,"line"),
          strip.text = element_text(size=9),
          legend.position = "bottom")
}
```

```{r create-coef-table}
#extract coefficient values from model summary as tibble
get_coefs <- function(x) {
  temp <- coef(x)[,c(1,2)]
  return(tibble(variable=rownames(temp), coef=temp[,1], se=temp[,2]))
}
#bind together the model summaries
bind_models <- function(models_summary) {
  temp <- lapply(models_summary, get_coefs) %>%
    bind_rows(.id="model") %>%
    filter(grepl("race_exog", variable))
  return(temp)
}

## Pentagon Models ##
coefs_pent <- list(census=models_census_pentagon,
                    acs_1980basis=models_acs1980_pentagon,
                    acs_full=models_acsfull_pentagon) %>%
  lapply(bind_models) %>%
  bind_rows(.id="data") %>%
  mutate(variable=convert_intermar_names(variable, "race_exog_pent"),
         model=factor(model,
                      levels=c("base","bendog","lendog","both"),
                      labels=c("Baseline model", "+ birthplace\nendogamy",
                               "+ language\nendogamy", "+ birthplace and\nlanguage endogamy")),
         data=factor(data,
                     levels=c("census","acs_1980basis","acs_full"),
                     labels=c("Census 1980", 
                              "ACS 2014-18, 1980 ethnic groups",
                              "ACS 2014-18, all ethnic groups"))) %>%
  order_variables("Census 1980", "+ both")

#create a dataset that can be used for the arrows in the graph
#need a reworked dataset for arrows
arrows_pent <- coefs_pent %>%
  filter(model=="+ birthplace and\nlanguage endogamy" & 
           variable!="South Asian ethnic exogamy" &
           data!="ACS 2014-18, all ethnic groups") %>%
  select(variable, coef, data) %>% 
  pivot_wider(names_from=data, values_from=coef) %>%
  rename(coef.census=`Census 1980`, 
         coef.acs=`ACS 2014-18, 1980 ethnic groups`)# %>%
  #filter(abs(exp(coef.census)-exp(coef.acs))>0.05)

## Extended Models ##
coefs_extended <- list(census=models_census_extended,
                       acs_1980basis=models_acs1980_extended,
                       acs_full=models_acsres_extended) %>%
  lapply(bind_models) %>%
  bind_rows(.id="data") %>%
  mutate(variable=convert_intermar_names(variable, "race_exog_extended"),
         model=factor(model,
                      levels=c("base","bendog","lendog","both"),
                      labels=c("Baseline", "+ birthplace endogamy",
                               "+ language endogamy", "+ both")),
         data=factor(data,
                     levels=c("census","acs_1980basis","acs_full"),
                     labels=c("Census 1980", 
                              "ACS 2014-18, 1980 ethnic groups",
                              "ACS 2014-18, expanded ethnic groups"))) %>%
  order_variables("Census 1980", "+ both")

#arrows
arrows_extended <- coefs_extended %>%
  filter(model=="+ both" & 
           variable!="South Asian ethnic exogamy" &
           data!="ACS 2014-18, expanded ethnic groups") %>%
  select(variable, coef, data) %>% 
  pivot_wider(names_from=data, values_from=coef) %>%
  rename(coef.census=`Census 1980`, 
         coef.acs=`ACS 2014-18, 1980 ethnic groups`) %>%
  filter(abs(exp(coef.census)-exp(coef.acs))>0.05)
```

```{r diversity}
temp <- alternates_census %>%
  filter(race!="AIAN" & race!="White" & race!="Black") %>%
  mutate(group=case_when(
    race %in% c("Chinese","Korean","Japanese","Vietnamese",
                     "Filipino","Cambodian","Hmong","Laotian",
                     "Thai","Burmese","Indonesian","Malaysian") ~ "E&SE Asian",
    race %in% c("Asian Indian","Bangladeshi",
                     "Pakistani","Sri Lankan") ~ "South Asian",
    race %in% c("Mexican","Puerto Rican","Cuban","Costa Rican",
                "Guatemalan","Honduran","Nicaraguan","Panamanian",
                "Salvadorian","Argentinian","Bolivian","Chilean",
                "Colombian","Ecuadorian","Paraguayan","Peruvian",
                "Uruguayan","Venezuelan","Dominican") ~ "Latino"),
    group=factor(group, levels=c("E&SE Asian","South Asian","Latino")))

diversity_ethnic <- temp %>%
  count(race, group, bpld) %>%
  group_by(race, group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_bpl=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="Census 1980")

diversity_ethnic <- temp %>%
  count(race, group, lang) %>%
  group_by(race, group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_lang=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="Census 1980") %>%
  full_join(diversity_ethnic)

diversity_pan <- temp %>%
  count(group, bpld) %>%
  group_by(group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_bpl=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="Census 1980")

diversity_pan <- temp %>%
  count(group, lang) %>%
  group_by(group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_lang=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="Census 1980") %>%
  full_join(diversity_pan)

temp <- alternates_acs %>%
  filter(race!="AIAN" & race!="White" & race!="Black") %>%
  mutate(group=case_when(
    race %in% c("Chinese","Korean","Japanese","Vietnamese",
                     "Filipino","Cambodian","Hmong","Laotian",
                     "Thai","Burmese","Indonesian","Malaysian") ~ "E&SE Asian",
    race %in% c("Asian Indian","Bangladeshi",
                     "Pakistani","Sri Lankan") ~ "South Asian",
    race %in% c("Mexican","Puerto Rican","Cuban","Costa Rican",
                "Guatemalan","Honduran","Nicaraguan","Panamanian",
                "Salvadorian","Argentinian","Bolivian","Chilean",
                "Colombian","Ecuadorian","Paraguayan","Peruvian",
                "Uruguayan","Venezuelan","Dominican") ~ "Latino"),
    group=factor(group, levels=c("E&SE Asian","South Asian","Latino")))

temp2 <- temp %>%
  count(race, group, bpld) %>%
  group_by(race, group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_bpl=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="ACS 2014-18")

diversity_ethnic <- temp %>%
  count(race, group, lang) %>%
  group_by(race, group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_lang=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="ACS 2014-18") %>%
  full_join(temp2) %>%
  bind_rows(diversity_ethnic) %>%
  select(race, group, data, diversity_bpl, diversity_lang)

temp2 <- temp %>%
  count(group, bpld) %>%
  group_by(group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_bpl=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="ACS 2014-18\nall ethnic groups")

diversity_pan <- temp %>%
  count(group, lang) %>%
  group_by(group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_lang=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="ACS 2014-18\nall ethnic groups") %>%
  full_join(temp2) %>%
  bind_rows(diversity_pan)

races1980 <- as.character(subset(diversity_ethnic, data=="Census 1980")$race)

temp2 <- temp %>%
  filter(race %in% races1980) %>%
  count(group, bpld) %>%
  group_by(group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_bpl=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="ACS 2014-18\n1980 ethnic groups")

diversity_pan <- temp %>%
  filter(race %in% races1980) %>%
  count(group, lang) %>%
  group_by(group) %>%
  mutate(p=prop.table(n)) %>%
  summarize(diversity_lang=1-sum(p^2)) %>% 
  ungroup() %>%
  mutate(data="ACS 2014-18\n1980 ethnic groups") %>%
  full_join(temp2) %>%
  bind_rows(diversity_pan)  %>%
  mutate(type="pan-ethnic group diversity")

temp2 <- diversity_ethnic %>%
  group_by(group, data) %>%
  summarize(diversity_bpl=mean(diversity_bpl),
            diversity_lang=mean(diversity_lang)) %>%
  ungroup() %>%
  mutate(data=ifelse(data=="ACS 2014-18", "ACS 2014-18\nall ethnic groups",
                     data))

diversity_pan <- diversity_ethnic %>%
  filter(race %in% races1980 & data=="ACS 2014-18") %>%
  group_by(group, data) %>%
  summarize(diversity_bpl=mean(diversity_bpl),
            diversity_lang=mean(diversity_lang)) %>%
  ungroup() %>%
  mutate(data="ACS 2014-18\n1980 ethnic groups") %>%
  bind_rows(temp2)  %>%
  mutate(type="mean of within ethnic group diversity") %>%
  bind_rows(diversity_pan) %>%
  pivot_longer(cols=starts_with("diversity_"), names_to="variable",
               values_to="diversity") %>%
  mutate(variable=ifelse(variable=="diversity_bpl",
                     "Birthplace",
                     "Language"),
         diversity=ifelse(group=="South Asian" & 
                            data!="ACS 2014-18\nall ethnic groups",
                          NA, diversity),
         data=factor(data,
                     levels=c("Census 1980", 
                              "ACS 2014-18\n1980 ethnic groups",
                              "ACS 2014-18\nall ethnic groups")),
         group=factor(group, 
                      levels=c("E&SE Asian", "Latino","South Asian")))
```

# Introduction

# Background

Studies that define and explain pan-ethnicity more broadly or in other areas

* Lopez and Espiritu, 1990. (NEED TO READ) One of the canonical works along with the book by Espiritu. Unfortunately, I cannot seem to get a PDF of the ERS article! Might have to actually go into library for this one (and the book).
* Okamoto and Mora, 2014. (NEED TO READ) An ARS article. Should be good.
* Mora, 2014. A good article on the growth of pan-ethnicity among Latinos through cross-field effects. Not sure how directly relevant it will be.
* Wimmer, 2008. Both his AJS and ERS articles as well as book will ge useful in framing pan-ethnicity as a "topographical" move of boundary expansion. 
* Kim and White (2010). (NEED TO READ) Looks at pan-ethnicity through residential segregation. Finds more pan-ethnicity among Latinos than Asians, which contrasts with the findings here.
* Lee 2019. (NEED TO READ) Focuses specifically on Asian Americans.
* Kibria, 1997. (NEED TO READ) Qualitative work on pan-ethnicity among Asian Americans centered around issues of intermarriage - I think some good arguments about how racialization affects pan-ethnicity. 

Studies on South Asian Distinctiveness in the US:

* Morning 2001. (NEED TO READ)
* Schachter, 2014. (NEED TO READ)


Studies that specifically look at pan-ethnic intermarriage: 

* Shinagawa and Pang, 1996. (NEED TO READ). Cannot get PDF!
* Qian, Blair, and Ruf, 2001. 1990 Census data. They use a 20-34 age range to restrict marriages and also remove couples where one person migrated between 1985 and 1990 to reduce the effect of pre-immigration marriages. They use the groups of Chinese, Korean, Japanese, Filipino, Southeast Asian, and Asian Indian (include Pakistani, Sri Lankan, and Bangladeshi). The results generally show that interethnic marriage is more common than marriage with whites, but also varies significantly by ethnicity, as does intermarriage with whites. They find that ethnic exogamy with Japanese Americans is most common and since this group is the most "assimilated" they see this as evidence of pan-ethnic assimilation. They also split their results. They also interact their terms with nativity and find that nativity increases both interracial and interethnic marriage. Also some good references here to work on how racialization affects pan-ethnicity for Asian Americans (mostly Espiritu 1992).
* Rosenfeld 2001. One of the most cited and a *Demography* paper. Rosenfeld's solution to the problem of uneven settlement patterns by ethnicity is to look at specific metropolitan areas. His main focus is Lost Angeles where he can jointly examine Asian and Latino pan-ethnicity, but he also does this for a few other cities and finds that the general results are similar. The comparison in LA is Mexican vs. Other Hispanic and Japanese vs. Other Asian, which I think is a bit crude. The log-linear models are also a bit tortured. However, the results are largely consistent with what I find in many ways. He finds that among the US born, Asian pan-ethnicity is stronger than Latino pan-ethnicity which he points out highlights the role racialization plays as opposed to cultural similarities among Latinos. Related to this, his other big finding is that pan-ethnic tendencies go *down* among native-born Latinos, which he attributes to the loss of Spanish as a pan-ethnic unifier. I don't see this so much in my data, because birthplace and language endogamy don't do much to shift over pan-ethnicity among Latinos.
* Qian and Cobas, 2004. So this article is basically Qian, Blair, and Ruf's approach applied to Latinos rather than Asians. They use the Latino groups of Mexicans, Puerto Ricans, Cubans, and "Central Americans." However, it is complicated by the strange decision to categorize Latinos by their racial id, despite many concerns about the validity of this measure for Latinos. They generally tend to find that among US-born non-white Latinos, it is more likely to marry a Latino of a different national origin than a non-Latino white. This is less clear for "White" Latinos, whatever that means. Like the other article, the overall odds of ethnic exogamy here are much lower than what I am getting for 1980 data, and I also think much lower than Fu's estimates with the same data. This could reflect the lack of adjusting for geographic specificity. In 1990, this would have had an important effect because of big differences in the settlement patterns of Mexicans, Puerto Ricans, and Cubans. 
* Fu 2007. He is using long-form 1990 Census data and finds substantial pan-ethnicity among Asians, but less so for Latinos. Like my results, he finds Latino/White intermarriage more likely than Latino ethnic exogamy. He accounts for Census division to deal with regional issues. Only includes small set of ethnicities.
* Okamoto, 2007. The paper uses 2000 PUMS data. It has a different methodology, with individual data nested in metropolitan areas, with an interest in how metro-level characteristcs affect odds of interracial vs. interethnic vs. ethnically endogamous unions (using multinomial logit models). Thus empirically, I don't think there is anything to compare to, but the theoretical arguments about a boundary approach are useful here and help frame my study. She has also made these points about the nested structure of panethnic identity, in other works including her book and they are similar to Wimmer's argument.
* Min and Kim, 2009. Uses ACS 2011-2006 to look at ethnic endogamy, ethnic exogamy, and interracial marriage among six Asian ethnic groups. They use raw percentages of the Asian partner, with no adjustments for group size, geography, double-dipping, or anything. This is not a good study. They seem to acknowledge at one point that these percentages largely reflect group sizes, but do nothing about it. Like why does this shit get published?
* Qian, Glick, and Batson, 2012. Uses Census 2000 data to look at four groups of Chinese, Filipinos, Mexicans, and Puerto Ricans. For all four groups, they find that the odds of pan-ethnic marriage are higher than intermarriage with whites. They split each group into those arriving at ages 14-19, 6-13, 0-5, and native-born. They find in each case that more time in US (or native born) is associated with more exogamy. Some differences across groups, but they also tend to find higher pan-ethnic exogamy for Mexicans and Puerto Ricans than Chinese and Filipinos. 
* Bohra-Mishra and Massey, 2014. (NEED TO READ) Can't make heads of tails of the tables, but I *think* this one looks specifically at pan-ethnic intermarriage, among other things.
* Smith 2017. (NEED TO READ) This paper looks a little odd, but it does cover pan-ethnic intermarriage among other things. Its also making a broader theoretical argument about the meaning of pan-ethnicity.
* Qian, Lichter, and Tumin, 2018. (NEED TO READ) Looks at intermarriage among Latinos, and includes measures on pan-ethnic vs co-ethnic intermarriage.

Other Stuff

* Kao and Joyner 2006. (NEED TO READ) Looks at pan-ethnicity in adolescent friendships.
* Hwang and Saenz, 1990. This article is seminal in its statement of the problem of including migrants in estimates of intermarriage without knowledge of where the union was formed. They show it upwardly biases rates of endogamy with examples of several Asian American groups.


# Data and Methods

The data for this analysis are derived from the microdata sample of the 1980 US Census and the American Community Survey (ACS) for 2014-2018. The ACS is an annual 1-in-100 survey of the United States population, conducted by the United States Census Bureau. The 1980 US Census is the last Census to include information about marriage timing. Information about marriage timing was added to the ACS in 2008. To increase sample size for smaller ethnoracial categories, I pool five years of ACS data from 2014-2018. Both data sources were extracted from the Integrated Public Use Microdata Series (IPUMS) system [@ruggles_ipums_2020].

I use a counterfactual marriage model [@qian_marriage_2018; @gullickson_counterfactual_2021] for the analysis that follows. In both data sources, I restrict the analysis to all opposite-sex marriages formed in the previous five years that were a first marriage for both partners. The restriction to opposite-sex first marriages is necessary for comparison because the Census 1980 only recorded marriage timing relative to first marriage and does not include same-sex unions. For each marriage, I then construct a choice set of one real union and twenty fictional unions. Fictional unions are created by sampling alternate partners for one randomly determined spouse from a pool of potential partners. I then use a conditional logit model to predict how partner characteristics relate to the likelihood of observing the true union, as follows:
$$P_{ij}=\frac{e^{\mathbf{x}_{ij}\beta}}{\sum_{k=1}^J e^{\mathbf{x}_{ik}\beta}}$$
where $P_{ij}$ is the probability that union $j$ within choice set $i$ is the actual union. $J$ is the total number of unions in the choice set (in this case, twenty-one). The vector $\mathbf{x}_{ij}$ defines the characteristics of the union and the $\beta$ vector provides estimated log-odds ratios indicating how the odds of an actual union change with $\mathbf{x}_{ij}$. The model is estimated as a fixed-effects logistic regression model with fixed effects for each choice set. 

The set of potential alternate partners from which fictional spouses are sampled is made up of all unmarried adults as well as those who were married in the previous five years. Because of uncertainty regarding timing of migration and marriage, individuals who migrated to the US or across state lines in the last five years are excluded from analysis as both actual and alternate marriage partners. To better capture the supply of potential partners in local marriage markets, alternate partners are sampled from among individuals residing in the same marriage market. I define marriage markets by the metropolitan area of residence when this can be identified for a respondent, and otherwise by the state of residence. Metropolitan area is not directly identifiable in the data used here due to confidentiality concerns, but can be deduced for many metropolitan areas based on the finest geographic identifier of the respondent (county group in Census 1980 and Public Use Microdata Area in the ACS). IPUMS provides metro area identification for respondents in cases where the county group or PUMA was mostly contained within the metropolitan area. Figure 1 shows the identifiable metropolitan areas used in the analysis for both time periods. Although not all metropolitan areas are identified in the data, most major metropolitan areas are included in both time periods. Coverage differs somewhat by period, with more extensive coverage in the later time period. 

```{r, fig.cap="Metropolitan statistical areas identifiable in the data by data source. Fill colors are drawn with partial transparency so that darker areas indicate overlapping areas in the two data sources."}
knitr::include_graphics(here("analysis","output","msa_map.pdf"), 
                        auto_pdf = TRUE)
```



Because this approach relies upon a random sample of alternate partners, results will vary each time this sampling procedure is performed. To account for the added uncertainty due to sampling, I preform the sampling procedure separately five times to produce five separate analytical datasets. I then run parallel models on all five datasets and pool $\beta$ estimates and standard errors using the same methods as those employed for multiple imputation [@rubin_multiple_1987]. 

This counterfactual marriage model approach has several advantages over the more well known log-linear approach to analyzing assortative mating. Most importantly, because the researcher can specify the parameters for sampling alternate partners, it is relatively easy to adjust for sub-national differences in group composition. Smaller groups in the population are more likely to be exogamous simply because there are fewer within-group potential partners available. Assortative mating researchers typically desire to factor out such "supply side" issues when estimating the likelihood of group exogamy. @harris_how_2005 have demonstrated that the uneven spatial distribution of racial groups across the US plays a significant role in restricting racial exogamy and log-linear models estimated at the national level will not account for this unevenness. This issue is likely to play an important role in this analysis, because Asian and Latino ethnic groups are not evenly distributed across the US. I account for this uneven spatial distribution by sampling alternate partners from within the same metropolitan area (or state, for respondents outside of an identifiable metropolitan area) such that potential partners more closely match the composition of the local marriage market for the focal partner.

The counterfactual model also has two other notable advantages over the log-linear model. First, it includes the unmarried population within the sample of alternate partners whereas the log-linear model only includes those who were married. Second, the linear model framework makes incorporation of a variety of quantitative and categorical control variables much easier.

## Variable Construction

I measure ethnoracial categories by a combination of the race and Hispanicity questions in both data sources. Table 1 shows the sample size for all ethnoracial groups included in the analysis. I classify non-Asian and non-Latino respondents as White, Black, or American Indian/Alaska Native (AIAN). Due to small sample size, I exclude Pacific Islanders, multriacial respondents, and non-Latino others from the analysis. The race question includes several Asian nationalities (e.g. Chinese, Korean, Filipino) as well as a write-in response for ethnic identities not captured by the existing categories. Similarly, the Hispanicity question includes major Latino ethnic groups (e.g. Mexican, Puerto Rican, Cuban) as well as a write-in option. Importantly, the Census 1980 data includes a far more limited set of identifiable ethnic groups for both Asians and Latinos than the ACS data. In Census 1980, I can only identify Mexicans, Puerto Ricans, and Cubans among Latinos and Chinese, Japanese, Korean, Filipino, Vietnamese, and Asian Indian respondents among Asians. To address this restriction, I estimate two different kinds of models for the ACS data. In the first model, I restrict the data only to those ethnic groups that were available in the Census 1980 data to allow more direct comparison over time. I also estimate models using the full ACS data, but these are not directly comparable to the Census 1980 results.

```{r sample-size-table}

temp <- c(table(alternates_acs$race)) %>% enframe()
tab_samp <- c(table(alternates_census$race)) %>% 
  enframe() %>%
  right_join(temp, by="name") %>%
  rename(ethnorace=name, census=value.x, acs=value.y) %>%
  mutate(race_big=case_when(
    ethnorace=="Chinese" ~ "East and Southeast Asian",
    ethnorace=="Japanese" ~ "East and Southeast Asian",
    ethnorace=="Korean" ~ "East and Southeast Asian",
    ethnorace=="Filipino" ~ "East and Southeast Asian",
    ethnorace=="Vietnamese" ~ "East and Southeast Asian",
    ethnorace=="Cambodian" ~ "East and Southeast Asian",
    ethnorace=="Hmong" ~ "East and Southeast Asian",
    ethnorace=="Laotian" ~ "East and Southeast Asian",
    ethnorace=="Thai" ~ "East and Southeast Asian",
    ethnorace=="Burmese" ~ "East and Southeast Asian",
    ethnorace=="Indonesian" ~ "East and Southeast Asian",
    ethnorace=="Malaysian" ~ "East and Southeast Asian",
    ethnorace=="Bhutanese" ~ "East and Southeast Asian",
    ethnorace=="Nepalese" ~ "East and Southeast Asian",
    ethnorace=="Asian Indian"  ~ "South Asian",
    ethnorace=="Pakistani" ~ "South Asian",
    ethnorace=="Bangladeshi" ~ "South Asian",
    ethnorace=="Sri Lankan" ~ "South Asian",
    ethnorace=="Mexican" ~ "Latino", 
    ethnorace=="Cuban" ~ "Latino", 
    ethnorace=="Puerto Rican" ~ "Latino", 
    ethnorace=="Guatemalan" ~ "Latino", 
    ethnorace=="Salvadorian" ~ "Latino", 
    ethnorace=="Dominican" ~ "Latino", 
    ethnorace=="Colombian" ~ "Latino", 
    ethnorace=="Costa Rican" ~ "Latino", 
    ethnorace=="Honduran" ~ "Latino", 
    ethnorace=="Nicaraguan" ~ "Latino", 
    ethnorace=="Panamanian" ~ "Latino", 
    ethnorace=="Argentinian" ~ "Latino", 
    ethnorace=="Bolivian" ~ "Latino", 
    ethnorace=="Chilean" ~ "Latino", 
    ethnorace=="Ecuadorian" ~ "Latino", 
    ethnorace=="Peruvian" ~ "Latino", 
    ethnorace=="Venezuelan" ~ "Latino", 
    ethnorace=="Paraguayan" ~ "Latino", 
    ethnorace=="Uruguayan"  ~ "Latino"
  ))

temp <- tab_samp %>% group_by(race_big) %>%
  summarize(census=sum(census, na.rm=TRUE), acs=sum(acs, na.rm=TRUE)) %>%
  na.omit() %>%
  rename(ethnorace=race_big)

tab_samp <- tab_samp %>% select(ethnorace, census, acs) %>%
  bind_rows(temp)

temp <- tibble(ethnorace="Marriages in the previous year",
               census=census_n, acs=acs_n)

tab_samp <- tab_samp %>% 
  bind_rows(temp)
                    
ord <- c("Marriages in the previous year",
         "White","Black","AIAN","Latino",
         "Mexican","Puerto Rican","Cuban","Salvadorian","Dominican","Guatemalan",
         "Colombian","Honduran","Peruvian","Ecuadorian","Nicaraguan","Argentinian",
         "Venezuelan","Panamanian","Chilean","Costa Rican","Bolivian",
         "Uruguayan","Paraguayan",
         "East and Southeast Asian",
         "Chinese","Filipino","Vietnamese","Korean","Japanese","Cambodian",
         "Hmong","Laotian","Thai","Burmese","Indonesian","Malaysian",
         "South Asian",
         "Asian Indian","Pakistani","Bangladeshi","Sri Lankan")

tab_samp <- as.data.frame(tab_samp)
rownames(tab_samp) <- tab_samp$ethnorace
tab_samp <- tab_samp[ord,]
rownames(tab_samp) <- NULL

options(knitr.kable.NA = '')

tab_samp %>%
  mutate(census=format(census, big.mark=","),
         census=ifelse(census=="       NA","",census),
         acs=format(acs, big.mark=",")) %>%
  kbl(caption = "Sample size of marriages and alternate partners by data source and ethnoracial category.", booktabs=T, longtable=F,
      linesep = NULL,
      col.names=c("Category","Census 1980", "ACS 2014-2018"),
      align = c("l","r","r")) %>%
  kable_styling(full_width = TRUE) %>%
  add_indent(c(6:24,26:37,39:42)) %>%
  pack_rows("Marriages", 1, 1) %>%
  pack_rows("Alternate Partners", 2, 42) %>%
  column_spec(1, width = "6cm")
```

I model interracial and panethnic marriage using a set of dummy variables where the reference category is a racially and ethnically endogamous union. Because the number of ethnoracial categories is large, modeling every possible combination of these categories for exogamous unions is not feasible, so I apply two limits on the parameterization. First, when analyzing intermarriage with Whites, Blacks, and American Indians/Alaska Natives, I group Asian and Latino ethnic groups into the larger pan-ethnic categories of Latino, East/Southeast Asian, and South Asian. For example, a union involving a black and Mexican partner and a union involving a black and Colombian partner would both be coded as a Black/Latino union. Second, for most of the models that follow, I model the likelihood of ethnic exogamy using a single dummy variable to indicate any form of ethnic exogamy within the three pan-ethnic categories of Latino, East/Southeast Asian, and South Asian. This allows me to estimate the average likelihood of ethnic exogamy within these groups, but does not capture particular affinities of disaffinities among ethnic groups within the pan-ethnic category. In some of the models that follow, I relax this assumption for the largest ethnic groups in order to estimate such affinities and disaffinities in the more recent ACS data.

Because I separate South Asian from East/Southeast Asian groups and only one South Asian ethnic group was identifiable in the Census 1980 data, I cannot estimate pan-ethnic parameters over time for South Asians. Thus, most of the analysis that follows will focus on pan-ethnicity among East/Southeast Asians and Latinos. However, I do estimate and report pan-ethnic parameters for South Asians for some models using ACS data.

I account for language and birthplace endogamy with simple dummy variables indicating whether the two potential partners share the same primary language or birthplace, respectively. Primary language is determined by what language the respondent reported speaking at home. Because this variable is measured after a marriage has occurred, it may somewhat overestimate language endogamy among respondents. Some partners who spoke different languages when they met may have shifted the language spoken at home after marriage. 

Birthplace endogamy is complicated by the "1.5" generation -- individuals who were born outside of the United States but migrated as children and whose formative experiences are at least partially defined by acculturation within the US. Within the coding scheme used here, I consider three possibilities for such individuals organized by the assumed degree of acculturation and assimilation. First such individuals could be considered birthplace endogamous only with individuals from the same actual birthplace. Second, such individuals could be considered birthplace endogamous with either an individual from their actual birthplace or the a person born in the USA. Third, such individuals could be considered only birthplace endogamous with other individuals born in the USA. 

To test the accuracy of these three scenarios, I fit models using each coding scheme to the Census 1980 and full ACS data. Following @rumbaut_ages_2004a, I also divide the 1.5 generation into a "1.75" generation (those who arrived in the US before the age of 6), a "1.5" generation (those who arrived in the US between the ages of 6-12), and a "1.25" generation (those who arrived in the US between the ages of 13-17). For these three groups, I consider every possible combination of coding such that earlier generations are not more acculturated than later generations (e.g. the 1.25 generation could not be "both" in cases where the 1.5 generation is "birthplace only"). Table 2 below shows the model fit of all ten possible combinations for both data sources.

```{r deviance-bendog}
dev_acs <- sapply(models_bendog_acs, function(x) {mean(x$deviance)}) %>%
  enframe(name="model", value="deviance_acs")

sapply(models_bendog_census, function(x) {mean(x$deviance)}) %>%
  enframe(name="model", value="deviance_census") %>%
  left_join(dev_acs) %>%
  mutate(gen1.75=c("Birthplace","USA","Both","USA","USA","USA","USA", "USA", 
                   "Both","Both"),
         gen1.5 =c("Birthplace","USA","Both","Both","Birthplace","USA","Both",
                   "USA", "Birthplace","Both"),
         gen1.25=c("Birthplace","USA","Both","Birthplace","Birthplace",
                   "Birthplace","Both","Both","Birthplace","Birthplace"),
         deviance_census=format(deviance_census, big.mark=","),
         deviance_acs=format(deviance_acs, big.mark=","),
         deviance_census=cell_spec(deviance_census,
                                   bold = ifelse(deviance_census=="1,122,736",
                                                       TRUE, FALSE)),
         deviance_acs=cell_spec(deviance_acs,
                                   bold = ifelse(deviance_acs=="1,849,202",
                                                       TRUE, FALSE)),
         ) %>%
  select(gen1.25, gen1.5, gen1.75, deviance_census, deviance_acs) %>%
  relocate(gen1.75, gen1.5, gen1.25, deviance_census, deviance_acs) %>%
  arrange(gen1.25, gen1.5, gen1.75) %>%
  kbl(caption = "Model fit to Census 1980 and ACS data using different specifications of birthplace endogamy for 1.25, 1.5, and 1.75 generations. Minimum deviance is shown in bold.", booktabs=T, longtable=F, 
      col.names=c("1.75","1.5","1.25","Census 1980","ACS 2014-18"),
      align = c("l","l","l","r","r"),
      linesep = NULL, escape = FALSE) %>%
  kable_styling(full_width = TRUE) %>%
  add_header_above(c("Generation" = 3, "Model Deviance" = 2)) %>%
  #column_spec(4, background = "red") %>%
  #column_spec(1, width = "5cm") %>%
# Goddmmit: apparently I need to use longtable to get wrapped footnotes, but then it won't float
  footnote(general=c("Age of US arrival by generation is 0-5 (1.75), 6-12 (1.5), and 13-17 (1.25). All models include",
                     "controls for educational differences, age differences, ethnoracial endogamy, and language",
                     "endogamy."), 
        threeparttable=F, footnote_as_chunk = F, 
          general_title="Notes: ", title_format="italic")
```

For both time period, the most preferred models use birthplace only coding for those respondents who entered the US after age 12. The USA only option representing full acculturation was not preferred for any group in either time period. In the Census 1980 data, the most preferred model treated all three groups the same as first generation individuals and only considered them endogamous with partners from the same actual birthplace. The more recent ACS data preferred a model in which both the 1.75 and 1.5 generations were considered birthplace endogamous both with partners from the actual birthplace or the USA. The shift over time suggests greater acculturation of the 1.5 and 1.75 generation today than in 1980. For all models in the analysis that follows, I code birthplace endogamy according to the best-fitting model for each data source from Table 2. 

All models used here include controls for age and educational differences between potential partners. Age differences are modeled by taking the numerical age difference between partners and its square. Educational differences are modeled using educational crossing parameters [@schwartz_trends_2005]. All respondents are categorized as having less than a high school diploma, a high school diploma, some college education, or at least a four-year college degree. Three dummy variables indicate whether a particular union involves crossing the adjacent pairwise boundaries between these four categories. Results are cumulative such that a marriage involving one partner with less than a high school education and one partner with a four-year college degree would require passing all three boundaries.

# Results

## Birthplace and Language Diversity

Before moving to the model results, I first show the complex ways in which birthplace and language endogamy affect the likelihood of ethnic and pan-ethnic endogamy. I use the Blau index [@blau_inequality_1977] to measure language/birthplace diversity within each Asian and Latino ethnic group and to measure diversity within each pan-ethnic group. The Blau index of diversity ($D$) is calculated as:
$$D=1-\sum_{i=1}^R p_i^2$$
where $p_i$ is the proportion of the total population belonging to group $i$ and $R$ is the total number of groups. The Blau index has an intuitively appealing interpretation as the probability that two randomly drawn members from the population belong to the same group. 


```{r diversity-pan-bar, fig.cap="Birthplace and language diversity within Asian and Latino ethnic groups compared to birthplace and language diversity within pan-ethnic groups. Diversity is measured by the Blau index which gives the probability that two randomly selected members of the group do not share the same birthplace/language."}
ggplot(diversity_pan, aes(y=group, x=diversity, color=type))+
  #geom_col(position="dodge")+
  geom_vline(xintercept = 0, color="grey20", linetype=1)+
  geom_pointrangeh(aes(xmin=0, xmax=diversity), size=0.4,
                   position=position_dodgev(height=0.6))+
  facet_grid(variable~data)+
  scale_x_continuous(labels = scales::percent, breaks = c(0, 0.25, 0.5, 0.75))+
  scale_color_manual(values = my_palette[1:2])+
  labs(y=NULL, x="Probability two members do not share the same birthplace/language",
       fill="type of diversity")+
  theme_mine()+
  theme(panel.grid.major.y = element_blank())
```

Figure 2 shows the Blau index for language and birthplace across E/SE Asian, South Asian, Latino ethnic and pan-ethnic groups, using data on alternate partners in the two time periods. To simplify presentation, I take the mean diversity within each specific ethnic group and compare this directly to the diversity across the pan-ethnic group as a whole.

It is notable that there is significant language and birthplace diversity within specific ethnic groups (e.g. Chinese, Mexican). For example, the average diversity in birthplace within specific Latino ethnic groups in the ACS data is nearly 60%, indicating that two randomly determined members of the same ethnic group would not share the same birthplace about 60% of the time. This diversity is mostly driven by within ethnic group differences between being born in the place of origin or being born in the US and speaking the common language of the origin group or speaking English. Pan-ethnic diversity on the other hand is driven by additional differences in non-US birthplace and non-English language across specific ethnic groups. The larger the difference between within ethnic group diversity and pan-ethnic diversity, the larger the barrier there is to pan-ethnic intermarriage. 

Figure 2 shows that pan-ethnic diversity in language and birthplace is greater than within ethnic group diversity for all three pan-ethnic groups in both time periods. However, these differences are trivially small Latinos, while they are quite large for Asians. Because Latinos share a common non-English language, this result was expected for language, but we also see a similar pattern here for birthplace. What differences exist among Latino ethnic groups have also diminished over time, whereas they have grown for E/SE Asians. 

The consequence of these patterns is that language and birthplace endogamy is an important barrier to pan-ethnic intermarriage among Asians, but plays little role in the pan-ethnic intermarriage among Latinos. With that in mind, I now turn to models that estimate the likelihood of pan-ethnic intermarriage with and without accounting for birthplace and language endogamy.


## Modeling Pan-Ethnicity

Figure 3 shows the estimated odds of ethnic exogamy relative to ethnic endogamy for all three pan-ethnic groups in both time periods. As these odds ratios approach one, the odds of ethnic exogamy (e.g. Chinese person marrying a Japanese person) increase relative to ethnic endogamy (e.g. Japanese person marrying a Japanese person). Due to data limitations, results are only available for South Asians in the more recent ACS data. 

```{r exog-lolly, fig.cap="The odds of ethnic exogamy for Latinos, East/Southeast Asians, and South Asians over time and model specification. Results are based on counterfactual marriage models. The baseline model controls for educational assortative mating and age differences."}
coefs_pent %>% 
  filter(variable=="E&SE Asian ethnic exogamy" | 
           variable=="Latino ethnic exogamy" |
           variable=="South Asian ethnic exogamy") %>%
  ggplot(aes(y=model, x=exp(coef), color=data))+
  geom_vline(xintercept = 0, color="grey20", linetype=1)+
  geom_vline(xintercept = 1, color="grey20", linetype=3)+
  geom_pointrangeh(aes(xmin=0, xmax=exp(coef)), size=0.4,
                   position=position_dodgev(height=0.6))+
  scale_color_manual(values=my_palette)+
  scale_x_continuous(limits = c(0,1))+
  labs(y=NULL, 
       x="Odds ratio of ethnic intermarriage relative to ethnic endogamy",
       color="Data source")+
  facet_wrap(~variable)+
  theme_mine()+
  theme(panel.spacing = unit(0.6, "lines"))
```

The baseline model includes only controls for age and educational differences between potential partners. I then include birthplace and language endogamy separately and together to determine the effects of these variables individually and collectively on the odds of ethnic exogamy. 

In the baseline model, the odds of ethnic exogamy are similar for all three groups. In all cases, ethnic exogamy is about one-quarter as likely as ethnic endogamy. The results also show a very slight decline from the 1980 time period to the 2014-2018 when restricting to ethnic groups that were available in the 1980 data.

For Latinos, adjusting for birthplace and language endogamy has little effect on the odds ratio. Controlling for each variable individually increases the overall odds of ethnic exogamy only very slightly, with birthplac endogamy having a slightly larger effect. Overall, however, the odds are hardly changed at all. Furthermore, there is no evidence of change across the two time periods when limiting the analysis to comparable ethnic groups. In the later time period, ethnic exogamy is higher when including a larger range of ethnic groups, but still remains relatively low.

For both Asian pan-ethnic groups, controlling for birthplace and language endogamy substantially increases the odds of ethnic exogamy, to the point that ethnic exogamy in the later time period is not unusual. For example, using the more expansive ethnic group coding, the odds of ethnic exogamy relative to ethnic endogamy are roughly 0.75 to 1 for both E/SE Asians and South Asians once I control for both language and birthplace endogamy. Controlling for language endogamy produces larger changes than controlling for birthplace endogamy, but both produce substantial changes, individually and collectively. 

Controlling for birthplace and language endogamy also reveals significant increases in the odds of ethnic exogamy over time for E/SE Asians. Using comparable ethnic groups, the odds of ethnic exogamy for E/SE Asians were about half those of ethnic endogamy in 1980, but have grown to 0.75 to 1 by the more recent time period.

Figure 3 shows the important role that birthplace and language endogamy play in pan-ethnic intermarriage. In actuality, we observe similar odds of ethnic exogamy among Asians and Latinos. However, the low odds of ethnic exogamy for Asians are largely a function of the high level of diversity in birthplace and language among Asians combined with a preference for marrying someone of the same birthplace and language. These barriers do not exist for Latinos. Controlling for these issues reveals very different affinities for pan-ethnicity among Latinos and Asians in the absence of birthplace and language barriers to pan-ethnic intermarriage. 

```{r changes-intermar, fig.cap="Odds of ethnoracial exogamy relative to endogamy across two time periods. Results are based on models that control for age differences, educational differences, and birthplace and language endogamy. Values are sorted by ethnoracial exogamy in 1980. Arrows show the change across the two time periods based on comparable sets of ethnic groups. Results for American Indian/Alaska Native intermarriage are excluded due to sampling variability."}
coefs_pent %>%
  filter(model=="+ birthplace and\nlanguage endogamy" & 
           !grepl("South Asian ethnic exogamy", variable) & 
           !grepl("AIAN", variable)) %>%
  left_join(arrows_pent) %>%
  mutate(variable=str_replace(variable, "E&SE Asian ethnic exogamy", "**E&SE Asian ethnic exogamy**"),
         variable=str_replace(variable, "Latino ethnic exogamy", "**Latino ethnic exogamy**"),
         coef=ifelse(data=="ACS 2014-18, all ethnic groups" & variable=="White/Black", NA, coef)) %>%
  order_variables("Census 1980", "+ birthplace and\nlanguage endogamy") %>%
  ggplot(aes(x=variable, y=exp(coef)))+
  geom_hline(yintercept = 1, linetype=3, size=1)+
  geom_point(aes(color=data, shape=data), alpha=1, size=3)+
  geom_segment(aes(x=variable, xend=variable,
                   y=exp(coef.census), yend=exp(coef.acs)),
               color="grey30",
               arrow = arrow(length = unit(0.03, "npc")))+
  coord_flip()+
  scale_y_continuous(limits=c(0,1.1), expand=c(0.01,0))+
  scale_color_manual(values = my_palette)+
  scale_shape_manual(values = c(16,16,17))+
  labs(x=NULL, 
       y="Odds ratio of exogamy relative to ethnoracial endogamy",
       title=NULL,
       color="Data source", shape="Data source")+
  theme_mine()+
  theme(axis.text.y=element_markdown())
```

Figure 4 shows the odds of E/SE Asian and Latino ethnic exogamy in comparison to the odds of interracial marriage more broadly. Figure 4 also shows how these odds have changed over time. All results in Figure 4 are from the model that accounts for birthplace and language endogamy. E/SE Asian ethnic exogamy stands out as far more likely than any form of interracial marriage. Latino ethnic exogamy, on the other hand, is comparable in likelihood to several forms of interracial marriage. White/Latino intermarriage was less like likely than Latino ethnic exogamy in 1980, but has increased in frequency substantially. The consequence of this shift is that White/Latino exogamy is roughly as likely as Latino ethnic exogamy in the later time period (NOT QUITE TRUE FOR EXPANDED ETHNIC GROUPS). 

Figure 4 also shows the results for South Asian interracial marriage over time. The results show significant declines in South Asian interracial marriage with all other groups over the time period. These results, however, should probably be viewed with caution. In the earlier time period, the only South Asian group available was "Asian Indian" and research has shown that respondents sometimes confuse the categories of "Asian Indian" and "American Indian" in race responses (CITE CAROLYN). Given the novel character of the "Asian Indian" category in 1980 (CHECK), it is likely that such misreporting has gone down over time. This may contribute to the overall decline in interracial marriage over time, if American Indians are less endogamous, on average, than Asian Indians.^[Although not shown here, I also found that the odds of intermarriage between American Indian/Alaska Natives and South Asians was slightly greater than one (EXACT NUMBER) in 1980 but declined to XX in the later ACS data. This result suggests that such race reporting errors played a greater role in 1980 than the later data.] Nonetheless, the results here do not suggest any particular affinity between South Asians and E/SE Asians in either time period, suggesting that Asian pan-ethnicity occurs within two separate "melting pots."

Figure 4 also documents that the lowest likelihood of intermarriage in both time periods is that between blacks and all other groups, despite some substantial increases in these odds. These results indicate the enduring strength of the black/non-black boundary in the US despite increasing diversity in the overall population. 

## Specific Affinities

The preceding models used a single ethnic exogamy term for each pan-ethnic group such that the odds of ethnic exogamy were assumed to be the same regardless of which specific groups were paired. For example, the odds of ethnic exogamy into a Japanese-Korean union would be the same as those for a Japanese-Filipino union. I now turn to models of the ACS data that relax this assumption and allow the estimation of specific affinities and disaffinities within the matrix of ethnic groups that make up the three pan-ethnic groups.

Fitting such models is actually quite difficult. If I considered every possible combination of ethnicities within pan-Ethnic groups in the ACS data, I would need to replace my three ethnic exogamy terms with 243 group specific parameters. Given that some of these groups are quite small in the dataset, models could not be fit to this fully expanded set, due to issues with sparseness and model convergence. I experimented with the largest possible set of ethnic groups for which I could reliably fit data and found that to include the five E/SE Asian ethnic groups available in the Census 1980 data (Chinese, Filipino, Vietnamese, Korean, and Japanese) and the ten largest Latino groups, with the exception of Hondurans. Because of the small size of non-Asian Indian groups in the South Asian categories I could not fit ethnicity specific models for South Asians.

Figure 5 shows the group-specific odds of ethnic exogamy for the five E/SE Asian ethnic groups, based on these models. I also provide a dendrogram that indicates the relative distance between each of these ethnic groups based on a tree diagram. The dendrogram is calculated by treating the inverse of the odds ratio as a measure of distance. 

```{r asian-heat-map, fig.cap="Odds of ethnic exogamy relative to ethnic endogamy between particular East and Southeast Asian ethnic groups in ACS 2014-2018 data. Dendrogram on the right is based on hierarchical clustering treating the inverse of these odds ratios as a distance measure and using unweighted average distances. All models control for age differences, education differences, and language and birthplace endogamy."}
asian_groups <- c("Chinese","Korean","Japanese","Vietnamese","Filipino")
or <- coefs_extended %>%
  filter(data=="ACS 2014-18, expanded ethnic groups" &
           model=="+ both" &
           grepl(paste(asian_groups,collapse="|"), variable) &
           !grepl("Black|White", variable)) %>% #ugly hack, FIXME
  calc_or_matrix()
hc <- hclust(as.dist(or), method = "average")
or <- or[hc$order, rev(hc$order)]

gg.heat <- ggplot(melt(1/or, na.rm=TRUE), aes(Var2, Var1, fill = value))+
  geom_tile(color = NA)+
  scale_fill_gradient2(low = "#7b3294", high = "#008837", mid = "#f7f7f7", 
                       midpoint = 1, limit = c(0, 1.25),
                       name="odds ratio")+
  geom_text(aes(label=paste(round(1/or,2))))+
  labs(x=NULL, y=NULL)+
  theme_minimal()+
  theme(legend.position = "left", 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle = 30, hjust = 1))

dendro <- as.dendrogram(hc)
gg.dendro <- ggdendrogram(data = dendro, rotate = TRUE, labels = FALSE)+theme_void()

grid.newpage()
print(gg.heat, vp = viewport(x = 0.4, y = 0.5, width = 0.8, height = 1.0))
print(gg.dendro, vp = viewport(x = 0.9, y = 0.57, width = 0.2, height = 0.68))
```

Figure 5 shows that there is no social distance between Chinese partners and the other five ethnic groups. In fact, the point estimates suggest that, holding constant language and birthplace endogamy, ethnic exogamy with Chinese partners is more likely than ethnic endogamy. However, none of these odds ratios are statistically distinguishable from zero. Even so, the results indicate that Chinese Americans serve as an important central node of pan-ethnicity in intermarriage, linking a variety of other groups.

The results also suggest little barriers to ethnic exogamy between Japanese and Koreans, possibly reflecting some shared cultural heritage. Filipinos, on the other hand, stand out in terms of their lower rates of ethnic exogamy with the other E/SE Asian groups, although even these odd of intermarriage are relatively high in comparison to both the odds of interracial marriage and Latino ethnic exogamy. DISCUSS LATINO-FILIPINO TERM HERE?

```{r latino-heat-map, fig.cap="Odds of ethnic exogamy relative to ethnic endogamy between particular Latino ethnic groups in ACS 2014-2018 data. Dendrogram on the right is based on hierarchical clustering treating the inverse of these odds ratios as a distance measure and using unweighted average distances. All models control for age differences, education differences, and language and birthplace endogamy."}
latino_groups <- c("Mexican","Puerto Rican","Cuban","Guatemalan",
            "Salvadorian","Colombian","Ecuadorian","Peruvian",
            "Dominican")
or <- coefs_extended %>%
  filter(data=="ACS 2014-18, expanded ethnic groups" &
           model=="+ both" &
           grepl(paste(latino_groups,collapse="|"), variable) &
           !grepl("Black|White", variable)) %>% #ugly hack, FIXME
  calc_or_matrix()
hc <- hclust(as.dist(or), method = "average")
or <- or[hc$order, rev(hc$order)]

gg.heat <- ggplot(melt(1/or, na.rm=TRUE), aes(Var2, Var1, fill = value))+
  geom_tile(color = NA)+
  scale_fill_gradient2(low = "#7b3294", high = "#008837", mid = "#f7f7f7", 
                       midpoint = 1, limit = c(0, 1.25),
                       name="odds ratio")+
  geom_text(aes(label=paste(round(1/or,2))), size=2.5)+
  labs(x=NULL, y=NULL)+
  theme_minimal()+
  theme(legend.position = "left", 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle = 30, hjust = 1))

dendro <- as.dendrogram(hc)
gg.dendro <- ggdendrogram(data = dendro, rotate = TRUE, labels = FALSE)+theme_void()

grid.newpage()
print(gg.heat, vp = viewport(x = 0.4, y = 0.5, width = 0.8, height = 1.0))
print(gg.dendro, vp = viewport(x = 0.9, y = 0.57, width = 0.2, height = 0.78))
```

Figure 6 shows comparable results for the nine largest Latino ethnic groups. The most notable feature of this figure is that ethnic affinities tend to cluster by region, with higher odds of intermarriage within the three groups of South American, Caribbean, and Mexican/Central American ethnicities. However, within the Caribbean group, Cubans are somewhat of an outlier, with significantly lower odds of intermarriage with Puerto Ricans and Domincans than between Puerto Ricans and Dominicans themselves.

Overall, the odds ratios in Figure 6 are much lower than those in Figure 5, reflecting the overall lower ethnic exogamy among Latino ethnic groups. The only case with no evidence of barriers to ethnic intermarriag was for Salvadorian and Guatemalans, where the estimated odds ratio is close to one. 


The second highest odds ratio in Figure 6 is for Puerto Ricans and Domincans, suggesting a relatively high affinity between these groups among Latino ethnic groups. This apparent affinity may in part reflect a shared Afro-Latino heritage combined with stronger racialization as black within the US (SOME CITATIONS HERE). To understand the role of Afro-Latino identity more broadly in the data, I included in the models parameters for intermarriage between non-Latino Blacks and each of the nine Latino ethnic groups shown in Figure 6. I also estimated a similar model for the three Latino groups in the 1980 Census data. The results of these models are shown in Figure 7. (NEW LANGUAGE NEEDED FOR NEW FIGURE 7)

```{r racial-exogamy, fig.cap="Odds of interracial marriage with Whites and Blacks for major Latino and E&SE Asian ethnic groups. For reference, odds of ethnic exogamy to other major ethnic groups are shown by small grey dots. All models control for age differences, education differences, and language and birthplace endogamy."}
panethnic <- coefs_extended %>%
  filter(grepl(paste(c(latino_groups,asian_groups),collapse="|"), variable) & 
           !grepl("Black|White", variable) & 
           model=="+ both" & 
           data=="ACS 2014-18, expanded ethnic groups") %>%
  select(variable, coef)

#convert this to simple dataframe of all the coefs for each ethnic group
panethnic <- bind_rows(lapply(c(latino_groups,asian_groups), function(x) {
  return(tibble(ethnicity=x, 
                coef= panethnic$coef[str_detect(panethnic$variable, x)]))
}))
panethnic$group <- factor(panethnic$ethnicity %in% asian_groups,
                          levels=c(FALSE,TRUE), labels=c("Latino","E&SE ASian"))

intermar <- coefs_extended %>%
  filter(grepl(paste(c(latino_groups,asian_groups), collapse="|"), variable) & 
           grepl("Black|White", variable) & 
           model=="+ both" & 
           data=="ACS 2014-18, expanded ethnic groups") %>%
  mutate(ethnicity=str_remove(variable, "Black\\/|\\/White"),
         race=factor(str_detect(variable, "Black\\/"),
                     level=c(FALSE,TRUE), labels=c("White","Black")),
         group=factor(ethnicity %in% asian_groups,
                      levels=c(FALSE,TRUE), labels=c("Latino","E&SE ASian"))) %>%
  select(ethnicity, group, race, coef)

ggplot(intermar, 
       aes(y=reorder(ethnicity, coef, max), x=exp(coef)))+
  geom_vline(xintercept = 0, color="grey70", linetype=1)+
  geom_vline(xintercept = 1, color="grey70", linetype=3)+
  geom_point(aes(color=race), size=3)+
  geom_point(data=panethnic, alpha=0.5)+
  scale_color_manual(values=my_palette)+
  scale_x_continuous(limits=c(0,1.2))+
  facet_wrap(~group, scales = "free_y")+
  labs(y=NULL, 
       x="Odds ratio of interracial marriage relative to ethnic endogamy",
       color="Interracial partner")+
  theme_mine()+
  theme(legend.position = "bottom")
```

The left panel of Figure 7 shows the change over time in the odds of Black/Latino intermarriage for thre three Latino ethnic groups present in the Census 1980 data. Although the odds increased for all three groups, the increase was modest for both Cubans and Mexicans, while substantial for Puerto Ricans. Puerto Ricans were already the most likely Latino group to intermarry blacks in 1980 and the relative odds increased to about 0.25 to 1 by 2014-2018. Those odds are somewhat lower than the odds of marrying other Latino groups which ranged from about 0.3 to 0.4, as shown in Figure 6. Nonetheless the odds of outmarriage to non-Latino Blacks are nearly as high for Puerto Ricans as outmarriage to some Latino ethnic groups. 

The right panel of Figure 7, shows the odds ratio of intermarriage with non-Latino blacks for all nine Latino ethnic groups in the ACS data. The figure clearly shows two groupings. Puerto Ricans and Dominicans have odds of black intermarriage that are roughly double the odds for the other seven Latino groups. Although the relative size of the Afrodescendant population in Latin American countries is difficult to measure, these differences may reflect the much higher prevalence of Afrodescent in Puerto Rican and Dominican populations and the racialization of members of these populations as black within the US. In this regard, the relatively low rate of intermarriage among Cubans stands out.

# Conclusions

1. Do we see evidence of pan-ethnicity in the marriage choices of Asians and Latinos and has this tendency changed over time?

2. Answering this question is seriously complicated by the diversity of birthplace and language among and within Asian and Latino ethnic groups due to the continuing high levels of immigration from Asia and Latin America. The tendency for people to marry someone of the same birthplace and who speaks the same language is a significant barrier to pan-ethnic intermarriage for Asians, but not for Latinos.

3. Once we account for birthplace and language endogamy, we see significant affinity between E/SE Asian and South Asian ethnic groups respectively. In the more recent ACS data, the odds of intermarrying with a member of a different ethnic group within the same pan-ethnic umbrella group were about 0.7 to 1 relative to marrying someone of the same exact ethnic group. In the case of E/SE Asians, where we can track this change over time, these odds have increased from about 0.5 to 1 in Census 1980. The results show little evidence of affinity between E/SE Asians and South Asians themselves, indicating that the growing pan-ethnicity among "Asians" is occurring in two distinct "melting pots."

4. For Latinos, there is little evidence of change over time and the tendency toward ethnic exogamy is much lower than for Asians. Adjusting for birthplace and language endogamy, the odds of ethnic exogamy relative to ethnic endogamy for Latinos is roughly 0.25 to 1 in both time periods. 

5. It is important to recognize that these odds ratios reflect underlying affinities but not actual frequencies. In practice, the tendency toward ethnic exogamy is affected by birthplace and language diversity. This affect severely reduces the actual odds of ethnic exogamy for Asians much more than Latinos and produces odds ratios that are similar across all three groups, at about 0.25 to 1. Thus the higher underlying affinities among Asians would only be realized in a situation in which most Asians were US born and spoke English as a primary language, reflecting a situation of decreased immigration and greater acculturation. 

6. Given that we see no sign of declines in immigration, we are less likely to see clear pan-ethnic identities emerge from pan-ethnic intermarriage but rather what Massey has described as fractured identities among both Asians and Latinos.

7. Why are the affinities among Latino ethnic groups lower than among Asian ethnic groups? This is somewhat surprising given that other research has noted the somewhat stronger basis for Latino pan-ethnicity. Language in particular has played a role in pan-ethnicity among Latinos, not simply in an ability to communicate in interpersonal situations, but in terms of creating pan-ethnic shared institutions. In some sense, language plays a role here in that it does not serve as a barrier to Latino groups in the same way that it does for Asians. However, the data clearly showed a weak affinity for ethnic exogamy among Latinos in comparison to Asians. This may reflect a deeper racialization of Asian identity. The idea of "Latino" as a racial category is still a contested idea and is contradicted by the phenotypic diversity of the Latino population, including but not limited to Afrodescent among some Latinos. On the other hand, "Asian" has a long history as a racial category in the US and more broadly, and was one of the original categories encoded by early  racial taxonomic systems. In short, the experience of racialization may bind acculturated Asian Americans more closely together than ethnic identity. Latino identity, however, may remain more of a "federated" identity.

8. Caveats about only one way to measure and identify pan-ethnicity.

# References
