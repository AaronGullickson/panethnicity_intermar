---
output:
  pdf_document:
    pandoc_args: './paper_info.yaml'
    citation_package: natbib
    fig_caption: yes
    template: ./resources/aog-latex-ms.tex
  word_document:
    pandoc_args: './paper_info.yaml'
    reference_docx: ./resources/aog_word_style.docx
  html_document:
    pandoc_args: './paper_info.yaml'
fontfamily: mathpazo
fontsize: 11pt
anonymous: false
endnotes: false
bibliography: ../project.bib
biblio-style: ./resources/ajs.bst
---

```{r setup, echo=FALSE, warning=FALSE, error=FALSE, include=FALSE}
# If you want to do things in one R Markdown document then use the 
# chunk option eval to toggle between running with and without 
# compiling R code chunks
knitr::opts_chunk$set(echo = FALSE, message = FALSE, error = FALSE, 
                      warning = FALSE, eval = TRUE)
library(here)
source(here("analysis","check_packages.R"))
source(here("analysis","useful_functions.R"))
load(here("analysis","output","models_restricted.RData"))
load(here("analysis","output","markets_census.RData"))
load(here("analysis","output","markets_acs.RData"))
```

```{r coef-table}
#extract coefficicent values
get_coefs <- function(x) {
  return(coef(x)[,c(1,3)])
}
temp <- lapply(models_census_summary, get_coefs)
coef_table <- NULL
for(i in 1:length(temp)) {
  coef_table <- rbind(coef_table, 
                      tibble(variable=rownames(temp[[i]]),
                             coef=temp[[i]][,"coef"],
                             se=temp[[i]][,"se(coef)"],
                             model=paste("Model",i),
                             data="Census 1980"))
}
temp <- lapply(models_acs_summary, get_coefs)
for(i in 1:length(temp)) {
  coef_table <- rbind(coef_table, 
                      tibble(variable=rownames(temp[[i]]),
                             coef=temp[[i]][,"coef"],
                             se=temp[[i]][,"se(coef)"],
                             model=paste("Model",i),
                             data="ACS 2014-18"))
}
coef_table$racial_exog <- grepl("race_exog", coef_table$variable)
#fix up the names
temp_names <- unique(coef_table$variable)
better_names <- c("age difference", "age difference squared",
                  "female educational hypergamy", "female educational hypogamy",
                  "educational crossing LHS/HS", "educational crossing HS/SC",
                  "educational crossing SC/C", "Black/White","Indigenous/White",
                  "Asian/White","Hispanic/White","Asian Indian/White",
                  "Black/Indigenous","Black/Asian","Black/Hispanic",
                  "Black/Asian Indian","Indigenous/Asian","Indigenous/Hispanic",
                  "Indigenous/Asian Indian","Asian/Hispanic",
                  "Asian/Asian Indian","Hispanic/Asian Indian",
                  "Asian ethnic exogamy","Hispanic ethnic exogamy", 
                  "birthplace endogamy","language endogamy")
names(better_names) <- temp_names
coef_table$variable <- better_names[coef_table$variable]
coef_table$model <- factor(coef_table$model,
                           levels=paste("Model",1:4),
                           labels=c("Baseline", "+ birthplace endogamy",
                                    "+ language endogamy", "+ both"))
coef_table$data <- factor(coef_table$data,
                          levels=c("Census 1980", "ACS 2014-18"))
```

```{r theme}
theme_mine <- function() {
  theme_bw()+
    theme(axis.title = element_text(size=8), 
          axis.text = element_text(size=7),
          legend.text=element_text(size=7),
          legend.title=element_text(size=8),
          legend.key.size = unit(0.8,"line"),
          strip.text = element_text(size=7),
          legend.position = "right")
}
```
  
# Introduction

Race scholars working in the American context have frequently raised the question of whether Hispanic and Asian ethnic groups are developing pan-ethnic identities around large aggregate identities of "Latino", "Hispanic", "Asian", etc. rather than more particular identities tied to national origin groups (CITATIONS). Understanding this pan-ethnicity gives us a better understanding of the dynamism of racial boundaries in the US and the likely future political and cultural constellations produced by these shifting racial boundaries (CITE Racial Pentagon?). To address the question of pan-ethnicity empirically, researchers have frequently used intermarriage patterns, because the propensity to cross racial or ethnic lines is thought to be a strong indicator of the strength of racial boundaries (CITATION). 

Previous work using intermarriage as an indicator of pan-ethnicity has found some evidence of pan-ethnicity among Asian and Hispanic ethnic groups (CITATIONS), although there is discrepancy in the strength of such pan-ethnicity among Hispanics, in particular. However, this work has been hampered by methodological difficulties. First, most studies of intermarriage do not account for the strong regional variation in how racial and ethinc groups are distributed (CITE Harris and Ono). If groups are not evenly distributed across space, then the lack of intermarriage between them may simply reflect lack of exposure. This problem may be particularly accute for pan-ethnicity due to differences in settlement pattern among different national-origin groups. For example, Cuban Americans are heavily concentrated in Florida while Mexican Americans are heavily concentrated in the western US. Adjustments can be made for these geographic concerns but often lead to complex models and/or limitations when using the dominant log-linear method to examine patterns of interracial marriage. For example, Rosenfeld (CITE) limits his analysis to a few metropolitan area, while Fu (CITE) controls for region of the US. 

Second, two other forces may significantly alter pan-ethnic tendencies that need to be accounted for in any model. First, immigrants who marry in the US may prefer to marry other immigrants from the same country of origin. This birthplace endogamy will reduce the tendency to marry across ethnic lines among Hispanics and Asians. However it should not be conflated with ethnic endogamy more broadly. Second, individuals may prefer to marry individuals who speak the same primary language. Language endogamy has a complex relationship to pan-ethnicity. For Hispanics, language endogamy would be expected to increase the strength of pan-ethnicity because all of these groups share the use of a single language. For Asians, on the other hand, language endogamy, would be expected to reduce the strength of pan-ethnicity because different national-origin groups do not share a common language. Regardless, it is important to distinguish language endogamy from pan-ethnicity more broadly defined and understand how much language endogamy affects estimates of pan-ethnicity.

In this paper, I employ a newly developed technique for estimating patterns of assortative mating, detailed below, that is able to more systematically address these issues than prior techniques. I utilize this technique to examine patterns of interracial marriage with a focus on pan-ethnic intermarriage using data from the 1980 Census and the American Community Survey (ACS) from 2014-2018.. Specifically, I examine how strong the boundaries are between Hispanic and Latino ethnic groups relative to the boundaries between racial groups and how the stength of these boundaries has changed over time. Furthermore, I show how estimates of the strength of these boundaries are affected by controls for birthplace and language endogamy.

I choose these two time periods because the data for these time periods allow me to isolate marriages that have been formed recently. Since 2008, the ACS has included a question on the year of the current marriage for individuals who are married. Timing of marriage was also included for first marriages in the 1980 Census, but was removed from the 1990 and 2000 Censuses as well as the ACS prior to 2008. Although the early time period was chosen partially due to data restrictinos, it is also an important historical point for this anslysis. The 1980 period provides a window into racial boundaries barely more than a decade after the post-1968 increase in migration from Asia and Latin America that substantially altered the racial makeup of the US. The contemporary period allows me to examine these racial boundaries roughly a generation later. 

# Data and Methods

The technique I use here is a counterfactual marriage model. For each existing union, I re-sample alternate partners from the same geographical area. For each union, I thus have a choice set of one real union as well as a set of counterfactual unions that did not occur. I use a conditional logit model to estimate how characteristics of a given union actually predict which unions are real. This method has been used previously by a handful of scholars for other purposes. It is ideally suited for the research question here because it implicitly controls for different geographical distributions by sampling only from a local marriage market and it allows for the easy incorporation of other control variables such as birthplace and language endogamy.

For both time periods, the data consist of all couples married in the past five years as well as all currently single individuals who have been in the US for at least five years. I also exclude immigrants who were married prior to their arrival in the US. From these data, I re-sample 25 alternate partners for either the husband or wife (randomly chosen) of each existing marriage. Alternate partners are drawn from both currently single individuals and partners in other marriages. These partners are drawn from individuals living in the same state. Ideally, I would use a smaller geographic unit to measure the marriage market, but this data is limited in the public-use Census data and would create differences in coverage between the two time periods. Most of the regional variation in distribution by race and ethnicity is addressed by the use of states rather than the whole nation (CHECK Does Fu say this?). 

The model estimates the log-odds that a given match is the real match as a function of partner characteristics. In all models, I control for age and educational differences between spouses. I address age differences by including the linear age difference between spouses and its square into each model. I address educational differences by using the common "educational crossing" model as well as dummy variables for female educational hypergamy and hypogamy. The educational crossing parameters are dummy variables that indicate whether a given union would cross an educational threshold between spouses. I use three parameters between those with less than high school/high school or more, high school or less/some college or more, and some college or less/four year college degree or more. 

To address interracial and interethnic marriage, I first code respondents into racial categories. For the non-Hispanic and non-Asian groups, I use the categories of White, Black, and Indigenous. The Indigenous category includes both American Indian and Pacific Islander groups. For the Hispanic and Asian groups, I use the most common national-origin groups from the hispanicity and race questions, respectively, that are identifiable in both datasets. For Asians, I identify respondents as Chinese, Japanese, Korean, Filipino, Vietnamese, or Asian Indian. For Hispanics, I identify respondents as Mexican, Cuban, and Puerto Rican (NOTE ON LATER DATA). All respondents who do not fall into any of these categories, including multiracial respondents, are dropped from the analysis. Tables 1 and 2 show the cross-tabulation of race for actual marriages in the Census 1980 and ACS 2014-18 data, respetively.

```{r}
tab <- with(subset(markets_census, choice),
            table(raceh, racew))
colnames(tab) <- substr(colnames(tab), 1,1)
knitr::kable(tab, caption="Cross-tabulation of husband's race (row) by wife's race (column) among couples married in the last five years, Census 1980")
tab <- with(subset(markets_acs_shortrace, choice),
            table(raceh, racew))
colnames(tab) <- substr(colnames(tab), 1,1)
knitr::kable(tab, 
             caption="Cross-tabulation of husband's race (row) by wife's race (column) among couples married in the last five years, ACS 2014-18")
```

To model patterns of interracial marriage. I first create dummy variables indicating specific racially exogamous unions using large pan-ethnic groupings (e.g. Black/White, Asian/White, Black/Hispanic). I then include separate dummy variables for marriages where both partners belong to different Asian or Hispanic ethnic groups. The latter terms measure the strength of ethnic exogamy within the large pan-ethnic Asian and Hispanic groups. Additionally, because of prior work suggesting that Asian Indians do not fit well within existing American racial classifications (CITE Ann), I include separate parameters measuring intermarriage between Asian Indians and all other groups. 

Finally to model birthplace and language endogamy, I include two separate dummies that measure whether the partners were born in the same country or speak the same language at home, respectively. I assume that Because I want to see how these parameters affect my ethnic exogamy terms, I test models with and without these terms.

# Preliminary Results

Figure 1 shows how estimates of Asian and Hispanic ethnic exogamy change as a result of controlling for birthplace and language endogamy for both time periods. The estimates of ethnic exogamy show the odds of marrying a fellow Asian/Hispanic of a different ethnic group (e.g. Chinese and Japanese) rather than an Asian/Hispanic person of the same ethnic group (e.g. both Chinese). I control for birthplace and language endogamy separately as well as a model in which they are both included.

```{r panethnic-coef-fig, fig.cap="Strength of Hispanic/Asian ethnic exogamy based on different model specifications and time periods. Baseline model controls for age and educational differences between spouses."}
ggplot(subset(coef_table, 
              variable=="Asian ethnic exogamy" | 
                variable=="Hispanic ethnic exogamy"), 
       aes(x=variable, y=exp(coef), color=model))+
  facet_wrap(~data)+
  coord_flip()+
  geom_point(size=2)+
  labs(x=NULL, 
       y="odds ratio of union formation for Hispanic/Asian ethnic intermarriage relative to ethnic endogamy")+
  scale_color_manual(values=lacroix_palette("PassionFruit", type="discrete"))+
  #scale_color_manual(values=wes_palette("Moonrise2"))+
  theme_mine()+
  theme(legend.position = "bottom")
```

The effects of the controls on ethnic exogamy are somewhat similar for both time periods, but differ substantially for Asians and Hispanics. For Asians, controlling for birthplace and language endogamy substantially reduces the barrier to ethnic exogamy. In the 1980 data, language endogamy seems to have a bigger effect than birthplace endogamy, but in the later ACS data, both forms of endogamy substantially affect ethnic exogamy. In the ACS data, the overall reduction in the ethnic exogamy term is much more substantial for each control. When controlling for both forms of endogamy, the odds of ethnic exogamy among Asians is mor than 80% of what we expect for two partners who are ethnically endogamous, suggesting relatively minor barriers to ethnic exogamy among Asians.

For Hispanics, the change in the ethnic exogamy parameter is much smaller once controls are added for birthplace and language endogamy. Birthplace endogamy consistently reduces barriers to ethnic exogamy, but the results are more complicated for language endogamy, as expected. In the 1980 data, controlling for language endogamy in addition to birthplace endogamy actually increases the strength of ethnic exogamy relative to model with only birthplace endogamy. Given that many Hispanics speak the same language at home across ethnic groups, this result was expected. This same pattern is not observed in the more recent ACS data, although language endogamy has a negligible impact on ethnic exogamy once birthplace endogamy is controlled. Overall, the barriers to ethnic exogamy is stronger for Hispanics than Asians across all models, suggesting weaker pan-ethnicity among Hispanics.

In Figure 2, I examine the strength of these ethnic exogamy terms in relation to the racial exogamy parameters. The figure shows the estimate for each parameter at both time points as well as an indication of whether exogamy for a given case has increased or decreased across the time period. Movement to the right indicates that exogamy has become more common over the time period, while movement to the left indicates that exogamy has become less common over the time period. I use models that control for language and birthplace endogamy for this analysis. 

```{r racial-exog-fig, fig.cap="Strength of racial exogamy across two different time periods. Results are based on large racial groupings with additional parameters for Asian and Hispanic ethnic exogamy. Asian Indians are included as a separate group. All results are based on models that account for age and educational differences between spouses as well as birthplace and language endogamy. Each category is ordered based on the value in the ACS 2014-18 data."}
#need a reworked dataset for arrows - try tidyverse style
temp <- coef_table %>%
  filter(model=="+ both") %>%
  dcast(variable+racial_exog~data, value.var="coef") %>%
  rename(coef.census=`Census 1980`, coef.acs=`ACS 2014-18`)

#reorder based on ACS values
temp$variable <- reorder(temp$variable, temp$coef.acs, max)
coef_table$variable <- factor(coef_table$variable,
                              levels=levels(temp$variable))

ggplot(subset(coef_table, racial_exog & model=="+ both"), 
       aes(x=variable, y=exp(coef)))+
  geom_hline(yintercept = 1, linetype=2)+
  geom_point(aes(color=data), size=2)+
  geom_segment(data=subset(temp, racial_exog), 
               aes(x=variable, xend=variable, 
                   y=exp(coef.census), yend=exp(coef.acs)),
               arrow = arrow(length = unit(0.02, "npc")),
               color="grey60", alpha=0.6)+
  coord_flip()+
  scale_y_log10()+
  scale_color_manual(values=lacroix_palette("PassionFruit", type="discrete"))+
  #scale_color_manual(values=wes_palette("Moonrise2"))+
  labs(x=NULL, 
       y="odds ratio of union formation relative to racially endogamous union",
       color="data source")+
  theme_mine()

```

The only cases where exogamy has become less common all involve at least one of two groups. First, every case of exogamy involving the Indigenous category became less common, with the exception of Black/Indigenous exogamy. This result may be driven by the change to a check all that apply option to the race question in 2000. Research has shown that membership in the American Indian and Pacific Islander categories are highly fluid, particularly in combination with another race. By excluding individuals who identified with more than one race, the Indigenous population identified in the ACS data may more strongly identify with their Indigenous background than the same group in 1980, which may affect rates of exogamy.

Exogamy also become rarer for every combination involving an Asian Indian. This finding suggests a strengthening boundary between Asian Indians and other racial groups over time. The lowest boundary was between Asians and Asian Indians, but this also became rarer over time and was much stronger than the Asian exogamy term itself, suggesting that Asian pan-ethnicity does not tend to include Asian Indians.

Interestingly, the most dramatic increase in boundaries was between the Indigenous and Asian Indian group. In fact, the model estimated that Indigenous/Asian Indian exogamy was more likely than endogamous unions in the 1980 data. It is possibly that this surpising affinity may reflect some uncertainty in the use of the term "Indian" for both groups in the 1980 data. This uncertainty may have declined over time with increasing familiarity. The ACS data suggested an odds of exogamy for the Indigenous/Asian Indian pairing that was similar in magnitude to that for the Indigenous/Asian pairing.

* Black/Non-Black boundary



# Further Work

