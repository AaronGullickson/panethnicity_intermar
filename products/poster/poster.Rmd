---
title: Changes in Pan-Ethnic Intermarriage in the United States, 1980-2018
author:
  - name: Aaron Gullickson
    affil: 1
    twitter: AaronGullickson
    email: aarong@uoregon.edu
    orcid: 0000-0001-7237-8131
    main: true
affiliation:
  - num: 1
    address: Department of Sociology, University of Oregon
main_findings:
  - 'Asian ethnic exogamy increased substantially over time while Hispanic ethnic exogamy was static.'
  - '![](big_splash.svg)'
logoright_name: '![](https://raw.githubusercontent.com/brentthorne/posterdown/master/images/qr-code-black.png){.main-img-right}'
main_picwidth: 90%
main_textsize: "90px"
main_textcol: "#FFFF0090"
font_family: "Lato"
main_fontfamily: "Indie Flower"
primary_colour: "#23395b"
secondary_colour: "#23395b"
accent_colour: "#EAEBEE"
title_textsize: "60pt"
output: 
  posterdown::posterdown_betterland:
    self_contained: false
    pandoc_args: --mathjax
    highlight: haddock
    number_sections: false
link-citations: true
bibliography: ../project.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(results = 'asis',
                      echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html")
library(ggplot2)
library(showtext)
library(gridExtra)
font_add_google("Lato")
font_add_google("Indie Flower")
showtext_auto()
library(here)
source(here("analysis","check_packages.R"))
source(here("analysis","useful_functions.R"))
load(here("analysis","output","models.RData"))
load(here("analysis","output","alternates.RData"))
load(here("analysis","output","models_bendog.RData"))

my_palette <- c("#7b3294","#008837","#a6dba0")
```

```{r create-coef-table, include=FALSE}
#extract coefficient values from model summary as tibble
get_coefs <- function(x) {
  temp <- coef(x)[,c(1,2)]
  return(tibble(variable=rownames(temp), coef=temp[,1], se=temp[,2]))
}
#bind together the model summaries
bind_models <- function(models_summary) {
  temp <- lapply(models_summary, get_coefs) %>%
    bind_rows(.id="model") %>%
    filter(grepl("race_exog", variable))
  return(temp)
}

## Pentagon Models ##
coefs_pent <- list(census=models_census_pentagon,
                    acs_1980basis=models_acs1980_pentagon,
                    acs_full=models_acsfull_pentagon) %>%
  lapply(bind_models) %>%
  bind_rows(.id="data") %>%
  mutate(variable=convert_intermar_names(variable, "race_exog_pent"),
         model=factor(model,
                      levels=c("base","bendog","lendog","both"),
                      labels=c("Baseline", "+ birthplace endogamy",
                               "+ language endogamy", "+ both")),
         data=factor(data,
                     levels=c("census","acs_1980basis","acs_full"),
                     labels=c("Census 1980", 
                              "ACS 2014-18, 1980 ethnic groups",
                              "ACS 2014-18, all ethnic groups"))) %>%
  order_variables("Census 1980", "+ both")

#create a dataset that can be used for the arrows in the graph
#need a reworked dataset for arrows
arrows_pent <- coefs_pent %>%
  filter(model=="+ both" & 
           variable!="South Asian ethnic exogamy" &
           data!="ACS 2014-18, all ethnic groups") %>%
  select(variable, coef, data) %>% 
  pivot_wider(names_from=data, values_from=coef) %>%
  rename(coef.census=`Census 1980`, 
         coef.acs=`ACS 2014-18, 1980 ethnic groups`) %>%
  filter(abs(exp(coef.census)-exp(coef.acs))>0.05)

## Extended Models ##
coefs_extended <- list(census=models_census_extended,
                       acs_1980basis=models_acs1980_extended,
                       acs_full=models_acsres_extended) %>%
  lapply(bind_models) %>%
  bind_rows(.id="data") %>%
  mutate(variable=convert_intermar_names(variable, "race_exog_extended"),
         model=factor(model,
                      levels=c("base","bendog","lendog","both"),
                      labels=c("Baseline", "+ birthplace endogamy",
                               "+ language endogamy", "+ both")),
         data=factor(data,
                     levels=c("census","acs_1980basis","acs_full"),
                     labels=c("Census 1980", 
                              "ACS 2014-18, 1980 ethnic groups",
                              "ACS 2014-18, expanded ethnic groups"))) %>%
  order_variables("Census 1980", "+ both")

#arrows
arrows_extended <- coefs_extended %>%
  filter(model=="+ both" & 
           variable!="South Asian ethnic exogamy" &
           data!="ACS 2014-18, expanded ethnic groups") %>%
  select(variable, coef, data) %>% 
  pivot_wider(names_from=data, values_from=coef) %>%
  rename(coef.census=`Census 1980`, 
         coef.acs=`ACS 2014-18, 1980 ethnic groups`) %>%
  filter(abs(exp(coef.census)-exp(coef.acs))>0.05)
```

```{r bigsplash, include=FALSE}
svg('big_splash.svg', height=17, width=20, pointsize=12)
coefs_pent %>% 
  filter(variable=="E&SE Asian ethnic exogamy" | variable=="Latino ethnic exogamy") %>%
  ggplot(aes(y=model, x=exp(coef), color=data))+
  geom_vline(xintercept = 0, color="grey70", linetype=1, size=2)+
  geom_vline(xintercept = 1, color="grey70", linetype=3, size=2)+
  geom_pointrangeh(aes(xmin=0, xmax=exp(coef)),
                   position=position_dodgev(height=0.5), size=4)+
  scale_color_manual(values=my_palette)+
  scale_x_continuous(limits=c(0,1), expand=c(0,0))+
  labs(y=NULL, 
       x="Odds ratio of ethnic intermarriage relative to ethnic endogamy",
       color="Data source")+
  facet_wrap(~variable)+
  theme_bw()+
  theme(text = element_text(colour="#EAEBEE", family="Lato"),
        axis.line.x = element_line(colour="#EAEBEE", size = 2),
        axis.line.y = element_blank(),
        axis.ticks = element_line(colour="#EAEBEE", size = 1),
        axis.title = element_text(size=40),
        axis.text = element_text(size=30, colour="#EAEBEE"),
        strip.text = element_text(size=40, colour="#23395b"),
        plot.title = element_text(size=60, hjust=0),
        plot.title.position = "panel",
        plot.subtitle = element_text(size=40, hjust=0),
        plot.caption = element_text(size=30, hjust=1, vjust=1),
        plot.caption.position = "panel",
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        legend.title = element_text(size=30),
        legend.text = element_text(size=25),
        panel.border = element_rect(fill=NA, colour=NA),
        panel.spacing = unit(5, "lines"),
        panel.background = element_rect(fill = "#23395b",colour = NA),
        plot.background = element_rect(fill = "#23395b",colour = NA),
        legend.background = element_rect(fill = "#23395b",colour = NA),
        legend.key = element_rect(fill = "#23395b",colour = NA), 
        legend.position = "bottom")
dev.off()
```

## Research Questions

* How has the likelihood of ethnic intermarriage (e.g. Japanese and Korean, Mexican and Puerto Rican) changed among Asians and Latinos?
* How does accounting for language and birthplace endogamy affect the likelihood of ethnic intermarriage?

I use 1980 Census data and recent American Community Survey data, which include variables on marriage timing, to address this question using newly-formed marriages. 

## Birthplace and Language Variation

```{r bplace-hetero}
alternates_acs %>%
  filter(race %in% c("Chinese","Korean","Japanese","Vietnamese",
                     "Filipino","Cambodian","Hmong","Laotian",
                     "Thai","Burmese","Indonesian","Malaysian",
                     "Mexican","Puerto Rican","Cuban","Costa Rican",
                     "Guatemalan","Honduran","Nicaraguan","Panamanian",
                     "Salvadorian","Argentinian","Bolivian","Chilean",
                     "Colombian","Ecuadorian","Paraguayan","Peruvian",
                     "Uruguayan","Venezuelan","Dominican")) %>%
  mutate(birthplace=factor(case_when(
    bpld==1 ~ "USA",
    bpld==50000 ~ "China",
    bpld==50010 ~ "Hong Kong",
    bpld==50020 ~ "Macau",
    bpld==50040 ~ "Taiwan",
    bpld==50100 ~ "Japan",
    bpld>=50200 & bpld<=50220 ~ "Korea",
    bpld==51100 ~ "Cambodia",
    bpld==51200 ~ "Indonesia",
    bpld==51300 ~ "Laos",
    bpld==51400 ~ "Malaysia",
    bpld==51500 ~ "Philippines",
    bpld==51600 ~ "Singapore",
    bpld==51700 ~ "Thailand",
    bpld==51800 ~ "Vietnam",
    bpld==52130 ~ "Myanmar",
    bpld==20000 ~ "Mexico",
    bpld==21020 ~ "Costa Rica",
    bpld==21030 ~ "El Salvador",
    bpld==21040 ~ "Guatemala",
    bpld==21050 ~ "Honduras",
    bpld==21060 ~ "Nicaragua",
    bpld==21070 ~ "Panama",
    bpld==30005 ~ "Argentina",
    bpld==30010 ~ "Bolivia",
    bpld==30020 ~ "Chile",
    bpld==30025 ~ "Colombia",
    bpld==30030 ~ "Ecuador",
    bpld==30045 ~ "Paraguay",
    bpld==30050 ~ "Peru",
    bpld==30060 ~ "Uruguay",
    bpld==30065 ~ "Venezuela",
    bpld==25000 ~ "Cuba",
    bpld==26010 ~ "Dominican Republic",
    bpld==11000 ~ "Puerto Rico",
    TRUE ~ "Other Place"),
    levels=c("USA","China","Hong Kong","Macau","Taiwan","Japan","Korea",
             "Cambodia","Indonesia","Laos","Malaysia","Philippines",
             "Singapore","Thailand","Vietnam","Myanmar","Mexico",
             "Costa Rica","El Salvador","Guatemala","Honduras",
             "Nicaragua","Panama","Argentina","Bolivia","Chile",
             "Colombia","Ecuador","Paraguay","Peru","Uruguay","Venezuela",
             "Cuba","Dominican Republic","Puerto Rico","Other Place")),
    race=fct_reorder(race, birthplace=="USA", mean),
    group=factor(race %in% c("Mexican","Puerto Rican","Cuban","Costa Rican",
                             "Guatemalan","Honduran","Nicaraguan","Panamanian",
                             "Salvadorian","Argentinian","Bolivian","Chilean",
                             "Colombian","Ecuadorian","Paraguayan","Peruvian",
                             "Uruguayan","Venezuelan","Dominican"),
                 levels=c(FALSE,TRUE),
                 labels=c("E & SE Asian","Latino"))) %>%
  select(race, birthplace, group) %>%
  droplevels() %>%
  ggplot(aes(x=race, fill=fct_rev(birthplace)))+
  geom_bar(position="fill")+
  scale_fill_manual(values = c("grey", brewer.pal(9, "Set1"),
                               "tomato","orchid","maroon","paleturquoise1",
                               brewer.pal(8, "Dark2"),
                               brewer.pal(12,"Set3"),"grey30"))+
  scale_y_continuous(labels = scales::percent, expand=c(0,0))+
  labs(x=NULL, y="cumulative percent by birthplace",
       title="Birthplace heterogeneity is high within and between Asian and Latino ethnic groups",
       caption="Data Source: ACS 2014-18, single and recently married adults",
       fill="Birthplace")+
  coord_flip()+
  facet_wrap(~group, scales="free_y")+
  guides(fill = guide_legend(reverse = TRUE, ncol=7))+
  theme_bw()+
  theme(legend.position = "bottom",
        legend.text = element_text(size=5),
        legend.title = element_text(size=8),
        axis.text.y = element_text(size=5),
        title = element_text(size=10),
        strip.text= element_text(size=9, color="#EAEBEE"),
        strip.background = element_rect(fill = "#23395b",colour = NA))
```

```{r language-hetero}
alternates_acs %>%
  filter(race %in% c("Chinese","Korean","Japanese","Vietnamese",
                     "Filipino","Cambodian","Hmong","Laotian",
                     "Thai","Burmese","Indonesian","Malaysian",
                     "Mexican","Puerto Rican","Cuban","Costa Rican",
                     "Guatemalan","Honduran","Nicaraguan","Panamanian",
                     "Salvadorian","Argentinian","Bolivian","Chilean",
                     "Colombian","Ecuadorian","Paraguayan","Peruvian",
                     "Uruguayan","Venezuelan","Dominican")) %>%
  mutate(lang=factor(case_when(
    lang==100 ~ "English",
    lang==4300 ~ "Chinese",
    lang==5400 ~ "Filipino, Tagalog",
    lang==5000 ~ "Vietnamese",
    lang==4900 ~ "Korean",
    lang==4800 ~ "Japanese",
    lang==4700 ~ "Thai, Siamese, Lao",
    lang==4420 ~ "Miao, Hmong",
    lang==5120 ~ "Mon-Khmer, Cambodian",
    lang==5440 ~ "Llocano, Hocano",
    lang==5200 ~ "Indonesian",
    lang==1200 ~ "Spanish",
    lang==4500 ~ "Burmese, Lisu, Lolo",
    lang==5420 ~ "Sebuano",
    lang==4430 ~ "Iu Mien",
    lang==4510 ~ "Karen",
    lang==5410 ~ "Bisayan",
    lang==4410 ~ "Miao-Yao, Mien",
    lang==5300 ~ "Malay",
    lang==1100 ~ "French",
    TRUE ~ "Other Language"),
    levels=c("English","Chinese","Japanese","Korean","Vietnamese",
             "Thai, Siamese, Lao","Mon-Khmer, Cambodian",
             "Burmese, Lisu, Lolo","Karen",
             "Filipino, Tagalog","Bisayan","Sebuano","Llocano, Hocano",
             "Miao, Hmong","Iu Mien","Miao-Yao, Mien",
             "Indonesian","Malay",
             "Spanish","French",
             "Other Language")),
    lang=fct_reorder(lang, lang, length, .desc=TRUE),
    lang=fct_relevel(lang, "English", after=0),
    lang=fct_relevel(lang, "Other Language", after=Inf),
    race=fct_reorder(race, lang=="English", mean),
    group=factor(race %in% c("Mexican","Puerto Rican","Cuban","Costa Rican",
                             "Guatemalan","Honduran","Nicaraguan","Panamanian",
                             "Salvadorian","Argentinian","Bolivian","Chilean",
                             "Colombian","Ecuadorian","Paraguayan","Peruvian",
                             "Uruguayan","Venezuelan","Dominican"),
                 levels=c(FALSE,TRUE),
                 labels=c("E & SE Asian","Latino"))) %>%
  select(race, lang, group) %>%
  droplevels() %>%
  ggplot(aes(x=race, fill=fct_rev(lang)))+
  geom_bar(position="fill")+
  scale_fill_manual(values = c("grey", brewer.pal(6, "Dark2"),
                               "tomato","sienna","orchid","maroon","paleturquoise1",
                               brewer.pal(6,"Set2"),"red","royalblue","grey30"))+
  scale_y_continuous(labels = scales::percent, expand=c(0,0))+
  labs(x=NULL, y="cumulative percent by primary language spoken",
       title="Language heterogeneity is much higher among Asians than Latinos",
       caption="Data Source: ACS 2014-18, single and recently married adults",
       fill="Primary language")+
  coord_flip()+
  facet_wrap(~group, scales="free_y")+
  guides(fill = guide_legend(reverse = TRUE, ncol=6))+
  theme_bw()+
  theme(legend.position = "bottom",
        legend.text = element_text(size=5),
        legend.title = element_text(size=8),
        axis.text.y = element_text(size=6),
        title = element_text(size=10),
        strip.text= element_text(size=9, color="#EAEBEE"),
        strip.background = element_rect(fill = "#23395b",colour = NA))
```




## Interracial vs Interethnic Marriage

```{r exog-compare-dot, fig.height=6}
temp1 <- coefs_pent %>%
  filter(model=="+ both" & grepl("E&SE Asian",variable) 
         & !grepl("AIAN", variable)) %>%
    select(variable, coef, data) %>%
  mutate(group="E&SE Asian Intermarriage")

temp2 <- coefs_pent %>%
  filter(model=="+ both" & grepl("Latino",variable) & 
           !grepl("AIAN",variable)) %>%
    select(variable, coef, data) %>%
  mutate(group="Latino Intermarriage")

temp <- bind_rows(temp1, temp2)
temp <- left_join(temp, arrows_pent)
temp$extended <- temp$data=="ACS 2014-18, all ethnic groups"

rect_data <- tibble(xmin=c(4.5,3.5), xmax=c(5.5,4.5), 
                    ymin=c(0,0), ymax=c(1.1,1.1),
                    group=c("E&SE Asian Intermarriage","Latino Intermarriage"))

ggplot(temp, aes(x=variable, y=exp(coef)))+
  geom_rect(data=rect_data, 
            aes(x=NULL, y=NULL, xmin=xmin, xmax=xmax, ymin=ymin, ymax=ymax),
            fill="yellow", alpha=0.4)+
  geom_hline(yintercept = 1, linetype=3, size=1)+
  geom_point(aes(color=data), size=4, alpha=0.6)+
  geom_segment(aes(x=variable, xend=variable,
                   y=exp(coef.census), yend=exp(coef.acs)),
               arrow = arrow(length = unit(0.03, "npc")),
                color="grey40", size=1)+
  facet_wrap(~group, scales = "free_y", ncol = 1)+
  coord_flip()+
  scale_y_continuous(limits=c(0,1.1), expand=c(0,0))+
  scale_color_manual(values = my_palette)+
  labs(x=NULL, 
       y=")dds ratio of exogamy relative to ethnoracial endogamy",
       color="Data source",
       title=NULL)+
  guides(color = guide_legend(ncol=1))+
  theme_bw()+
  theme(legend.position = "bottom",
        legend.text = element_text(size=12),
        legend.title = element_text(size=12),
        axis.text.y = element_text(size=12),
        axis.title.x = element_text(size=12),
        title = element_text(size=14),
        strip.text= element_text(size=12, color="#EAEBEE"),
        strip.background = element_rect(fill = "#23395b",colour = NA))
```

## Results for South Asians

```{r south-asian-exog-lolly}
coefs_pent %>%
  filter(variable=="South Asian ethnic exogamy") %>%
  ggplot(aes(y=model, x=exp(coef), color=data))+
  geom_vline(xintercept = 1, linetype=3, size=1)+
  geom_pointrangeh(aes(xmin=0, xmax=exp(coef)),
                   position=position_dodgev(height=0.5), size=2)+
  scale_color_manual(values=my_palette[3])+
  scale_x_continuous(limits=c(0,1.1), expand=c(0,0))+
  labs(y=NULL, 
       x="Odds ratio of ethnic intermarriage relative to ethnic endogamy",
       color="Data source",
       data=NULL)+
  theme_bw()+
  theme(legend.position = "bottom",
        legend.text = element_text(size=12),
        legend.title = element_text(size=12),
        axis.text.y = element_text(size=12),
        axis.title.x = element_text(size=12),
        title = element_text(size=14),
        strip.text= element_text(size=12, color="#EAEBEE"),
        strip.background = element_rect(fill = "#23395b",colour = NA))
```

## Findings

## Methods

I use a [counterfactual marriage model](https://www.demographic-research.org/volumes/vol44/22/default.htm):

1. I select all marriages formed within the previous five years, excluding those unions formed before migration to the US or when one partner migrated across state lines. 
1. For each real union, I sample 20 alternate partners for one randomly determined spouse from the same state of residence. 
2. I use a conditional logit model to predict which union is the real union based on partner characteristics.
3. All models control for age and educational differences between spouses.

| Data source | Number of actual unions |    
|:------------|------------------------:|
| Census 1980 | 288,377                 |
| ACS 2014-18 | 486,271                 |
